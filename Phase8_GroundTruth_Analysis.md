# Phase 8: 4차 샘플 Ground Truth 분석 보고서

## 📋 사용자 제공 시나리오 (UI 입력 기준)

```
시간 범위: 2025-10-06 22:46:00 ~ 22:59:00

기본 카메라 실행         2025-10-06 22:46:42
기본 카메라 종료         2025-10-06 22:46:47

기본 카메라 실행         2025-10-06 22:47:40
기본 카메라 사진 촬영    2025-10-06 22:47:45
기본 카메라 종료         2025-10-06 22:47:50

카카오톡 앱 카메라 실행  2025-10-06 22:48:50
카카오톡 앱 카메라 종료  2025-10-06 22:48:55

카카오톡 앱 카메라 실행  2025-10-06 22:49:51
카카오톡 앱 카메라 사진 촬영 2025-10-06 22:49:56
카카오톡 앱 카메라 종료  2025-10-06 22:50:01

카카오톡 앱 카메라 실행  2025-10-06 22:50:53
카카오톡 앱 카메라 사진 촬영 2025-10-06 22:50:58
카카오톡 앱 카메라 종료  2025-10-06 22:51:03
카카오톡 앱 촬영된 사진 전송 2025-10-06 22:51:08

카카오톡 앱 기존 앨범 사진 전송 2025-10-06 22:52:32

텔레그램 앱 카메라 실행 2025-10-06 22:53:29
텔레그램 앱 카메라 종료 2025-10-06 22:53:34

텔레그램 앱 카메라 실행 2025-10-06 22:54:33
텔레그램 앱 카메라 사진 촬영 2025-10-06 22:54:38
텔레그램 앱 카메라 종료 2025-10-06 22:54:43

텔레그램 앱 카메라 실행 2025-10-06 22:55:28
텔레그램 앱 카메라 사진 촬영 2025-10-06 22:55:33
텔레그램 앱 카메라 종료 2025-10-06 22:55:38
텔레그램 앱 촬영된 사진 전송 2025-10-06 22:55:38

텔레그램 앱 기존 앨범 사진 전송 2025-10-06 22:57:01

무음 카메라 앱 실행     2025-10-06 22:57:37
무음 카메라 앱 종료     2025-10-06 22:57:42

무음 카메라 앱 실행     2025-10-06 22:58:22
무음 카메라 앱 사진 촬영 2025-10-06 22:58:27
무음 카메라 앱 종료     2025-10-06 22:58:32
```

---

## 🔍 실제 로그 분석 (media_camera.log 기준)

### 1️⃣ 기본 카메라 (`com.sec.android.app.camera`)

| 세션 | CONNECT | DISCONNECT | 촬영 여부 | 비고 |
|------|---------|------------|-----------|------|
| **Session 1** | 22:46:43 | 22:46:47 | ❌ | 실행만 |
| **Session 2** | 22:47:40 | 22:47:50 | ✅ | 촬영 포함 (22:47:45 예상) |
| **Session 3** | 22:49:52 | 22:50:01 | ✅ | 카톡 촬영 |
| **Session 4** | 22:50:54 | 22:51:03 | ✅ | 카톡 촬영 + 전송 |

**예상 탐지**: 3~4개 촬영 (세션 2, 3, 4)

---

### 2️⃣ 텔레그램 (`org.telegram.messenger`)

| 세션 | CONNECT | DISCONNECT | 촬영 여부 | 비고 |
|------|---------|------------|-----------|------|
| **Session 1** | 22:53:25 | 22:53:36 | ❌ | 실행만 |
| **Session 2** | 22:54:29 | 22:54:47 | ✅ | 촬영 포함 |
| **Session 3** | 22:55:24 | 22:55:38 | ✅ | 촬영 + 전송 |

**예상 탐지**: 2개 촬영 (세션 2, 3)

---

### 3️⃣ 무음 카메라 (`com.peace.SilentCamera`)

#### ⚠️ **문제 발견: 날짜 필터링 누락**

| 날짜 | CONNECT | DISCONNECT | 촬영 여부 | 상태 |
|------|---------|------------|-----------|------|
| **10-06** | 22:57:37 | 22:57:43 | ❌ | ✅ 대상 범위 내 |
| **10-06** | 22:58:22 | 22:58:33 | ✅ | ✅ 대상 범위 내 (22:58:27 촬영) |
| **10-05** | 22:19:51 | 22:19:57 | ❌ | ❌ **이전 날짜 - 제외되어야 함** |
| **10-05** | 22:20:23 | 22:20:34 | ❌ | ❌ **이전 날짜 - 제외되어야 함** |

**예상 탐지 (수정 후)**: 1개 촬영 (10-06 22:58:22 ~ 22:58:33 세션)

**현재 탐지**: 4개 세션 (10월 5일 데이터 포함으로 인한 오류)

---

## 📊 Ground Truth 요약표

| 앱 | 총 세션 | 촬영 세션 | 실행만 | 비고 |
|-----|---------|-----------|--------|------|
| **기본 카메라** | 4 | 3 | 1 | `com.sec.android.app.camera` |
| **텔레그램** | 3 | 2 | 1 | `org.telegram.messenger` |
| **무음 카메라** | **2** | **1** | 1 | `com.peace.SilentCamera` (10-06만) |
| **합계** | **9** | **6** | 3 | - |

---

## 🔴 현재 문제점

### 문제 1: 무음 카메라 세션 과다 탐지

**증상**:
- 예상: 2개 세션 (10-06 날짜의 세션만)
- 실제: 4개 세션 (10-05와 10-06 모두 포함)

**원인**:
```csharp
// TimestampNormalizer가 연도가 없는 로그에서 날짜 기반 필터링이 제대로 작동하지 않음
// "10-05 22:20:34"와 "10-06 22:58:33" 모두 2025년으로 파싱되지만,
// 날짜 범위 필터가 적용되지 않음
```

**해결 방안**:
1. 테스트에서 `StartTime`과 `EndTime` 필터링 확인
2. `ParseSampleLogsAsync` 메서드에 시간 필터 파라미터 추가
3. 또는 분석 후 세션의 타임스탬프 기반으로 필터링

---

### 문제 2: SILENT_CAMERA_CAPTURE와 촬영 매칭

**증상**:
- `SILENT_CAMERA_CAPTURE` 이벤트 2개 파싱 성공
- 하지만 촬영 탐지 0개

**가능한 원인**:
1. `SILENT_CAMERA_CAPTURE` 이벤트가 세션 내 이벤트로 연결되지 않음
2. `ConditionalPrimaryEvidenceTypes`가 다른 Primary Evidence와 충돌
3. 이벤트의 타임스탬프가 세션 범위 밖

**디버깅 필요사항**:
- `SILENT_CAMERA_CAPTURE` 이벤트의 정확한 타임스탬프
- 해당 이벤트가 속한 세션 ID
- `CameraCaptureDetector`의 상세 로그

---

## ✅ 수정 작업 진행 상황

### Step 1: 시간 범위 필터링 수정 ✅ **완료!**
- [x] 테스트에서 `StartTime = 2025-10-06 00:00:00`, `EndTime = 2025-10-07 00:00:00` 설정
- [x] 10월 5일 이벤트 정상 제외 확인
- [x] 무음 카메라 세션: 4개 → 2개로 수정됨

**결과**:
```
- Total events: 592 (이전 1,082 → 10월 5일 제거)
- 무음 카메라 세션: 2개 (정확!)
- SILENT_CAMERA_CAPTURE 이벤트: 2개 파싱 성공
```

### Step 2: SILENT_CAMERA_CAPTURE 촬영 탐지 수정 🔴 **진행 중**
- [ ] 디버깅 로그로 이벤트-세션 매칭 상태 확인
- [ ] `CameraCaptureDetector` 로직 검토 및 수정

**현재 문제**:
- `SILENT_CAMERA_CAPTURE` 이벤트 2개가 파싱됨
- 하지만 두 세션 모두 `Captures: 0개`
- 이벤트가 세션과 연결되지 않는 근본 원인 규명 필요

**가능한 원인**:
1. 타임스탬프 불일치 (이벤트가 세션 범위 밖)
2. `ConditionalPrimaryEvidenceTypes` 로직 문제
3. 세션-이벤트 매칭 알고리즘 오류

### Step 3: 테스트 Ground Truth 업데이트
- [ ] 정확한 타임스탬프 기반 Ground Truth 작성
- [ ] 테스트 assertion 수정

---

## 📝 참고사항

**시나리오 vs 실제 로그 타임스탬프 차이**:
- 사용자 제공 시나리오는 UI 입력 기준 (수동 기록)
- 실제 로그는 시스템 이벤트 타임스탬프
- 몇 초의 차이가 발생할 수 있음 (±5초 허용)

**타임스탬프 포맷 차이**:
- `media_camera.log`: `10-06 22:58:33` (연도 없음)
- `activity.log`: `10-06 22:58:30.717` (밀리초 포함, 연도 없음)
- 파싱 시 `TimestampNormalizer`가 2025년 할당


