# ADB Media Camera Service Log Configuration
# Version: 1.0
# Description: Configuration for parsing Android ADB camera service logs (CONNECT/DISCONNECT events)

configSchemaVersion: "1.0"

metadata:
  logType: "adb_media_camera"
  supportedVersions: ["15"]
  displayName: "ADB Media Camera Service Log (Android 15)"
  description: "Parse ADB dumpsys media.camera logs for camera device connection/disconnection events"
  author: "System"
  createdDate: "2025-10-04"

# File matching patterns
filePatterns:
  - "media.camera.txt"
  - "media_camera*.txt"
  - "adb_media_camera*.log"
  - "dumpsys_media_camera*.txt"

# Global parsing settings
globalSettings:
  encoding: "utf-8"
  skipEmptyLines: true
  skipComments: false
  commentPrefix: "#"
  timeSeriesOrder: "descending"  # most recent at top (로그 특성)
  timestampFormat: "MM-dd HH:mm:ss"
  
# Performance settings
performance:
  maxFileSizeMB: 500
  timeoutSeconds: 300
  bufferSizeKB: 64
  useStreamingParser: false
  parallelProcessing: false

# Error handling
errorHandling:
  onInvalidLine: "skip"  # skip, abort, log
  onMissingTimestamp: "skip"
  onParsingError: "log"
  validateSchema: true

# Section definitions - divide log into manageable sections
sections:
  - id: "camera_events"
    name: "Camera Service Events"
    enabled: true
    startMarker: "== Camera service events log (most recent at top): =="
    endMarker: "== Camera device 0 status"
    markerType: "text"

# Line parsing rules for each section
parsers:
  # Camera Events Parser
  - id: "camera_event_parser"
    name: "Camera Connection Events Parser"
    enabled: true
    targetSections: ["camera_events"]
    priority: 1
    
    linePatterns:
      # CONNECT pattern
      # Example: 09-07 21:54:40 : CONNECT device 20 client for package com.sec.android.app.camera (PID 17833, priority 0)
      - id: "camera_connect_pattern"
        name: "Camera Device Connect"
        regex: '^\s+(\d{2}-\d{2} \d{2}:\d{2}:\d{2}) : CONNECT device (\d+) client for package ([\w\.]+) \(PID (\d+), priority (\d+)\)'
        fields:
          timestamp: { group: 1, type: "datetime", format: "MM-dd HH:mm:ss" }
          deviceId: { group: 2, type: "int" }
          package: { group: 3, type: "string" }
          pid: { group: 4, type: "int" }
          priority: { group: 5, type: "int" }
        eventType: "CAMERA_CONNECT"
      
      # DISCONNECT pattern
      # Example: 09-07 21:55:00 : DISCONNECT device 20 client for package com.sec.android.app.camera (PID 17833)
      - id: "camera_disconnect_pattern"
        name: "Camera Device Disconnect"
        regex: '^\s+(\d{2}-\d{2} \d{2}:\d{2}:\d{2}) : DISCONNECT device (\d+) client for package ([\w\.]+) \(PID (\d+)\)'
        fields:
          timestamp: { group: 1, type: "datetime", format: "MM-dd HH:mm:ss" }
          deviceId: { group: 2, type: "int" }
          package: { group: 3, type: "string" }
          pid: { group: 4, type: "int" }
        eventType: "CAMERA_DISCONNECT"

