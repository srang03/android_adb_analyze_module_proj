## **📚 3장 연구 설계 완전 이해 가이드**

### **1. 이중 Ground Truth 시스템이란?**

#### **🎯 핵심 개념**
**동일한 실험 데이터를 2가지 다른 관점으로 분석하는 시스템**

```
실험 상황:
- 세션 A: 카메라 앱 실행 후 촬영 안함 (촬영N)
- 세션 B: 카메라 앱 실행 후 촬영 함 (촬영Y)

이중 Ground Truth:
1. 카메라 사용 탐지 관점: A=1(사용함), B=1(사용함)
2. 카메라 촬영 탐지 관점: A=0(촬영안함), B=1(촬영함)
```

#### **🔍 왜 이중 시스템인가?**

**문제점**: 기존 연구는 "촬영 탐지"만 측정 → 로그별 특성 구분 불가

**해결책**: 각 로그가 **언제부터** 탐지되는지 구분 분석
- **서비스 계층 로그** (media.camera, usagestats): 카메라 앱 **실행 시**부터 탐지
- **행위 증거 로그** (audio, media.metrics): **실제 촬영 시**에만 탐지

#### **📊 실제 예시**

| 로그 | 촬영N 세션 | 촬영Y 세션 | 사용 탐지 성능 | 촬영 탐지 성능 |
|------|-----------|-----------|---------------|---------------|
| media.camera | 탐지(1) | 탐지(1) | **우수** (둘 다 탐지) | **제한적** (구분 못함) |
| audio | 미탐(0) | 탐지(1) | **제한적** (절반 놓침) | **우수** (완벽 구분) |

---

### **2. 로그 분석 방식 상세 설명**

#### **🗂️ 데이터 수집 단위: 세션별**

```
세션 = 1회의 독립된 실험
총 180세션:
- 파일럿: 20세션 (S1×5, S2×5, S3×5, S4×5, 모두 촬영Y, V0)
- 본실험: 160세션 (4앱×2케이스×4휘발성×5반복)
```

#### **📝 각 세션에서 수집하는 데이터**

```bash
세션 M_001 (S1_촬영Y_V0_1회차):
1. 삼성카메라 실행 → 사진 촬영 → 앱 종료
2. 즉시 6개 로그 수집:
   - media.camera: 탐지됨(1)
   - usagestats: 탐지됨(1) 
   - activity: 탐지됨(1)
   - audio: 탐지됨(1)
   - media.metrics: 탐지됨(1)
   - vibrator_manager: 탐지됨(1)
```

#### **📈 분석 단위: 그룹별 집계**

**1단계: 세션 데이터 수집** (180개 세션)
```
M_001: S1, 촬영Y, V0, [1,1,1,1,1,1]
M_002: S1, 촬영N, V0, [1,1,1,0,0,0]
M_003: S2, 촬영Y, V0, [1,1,1,1,1,0]
...
```

**2단계: 그룹별 성능 계산** (앱별 분석 예시)
```python
# S1 앱의 media.camera 성능 계산
S1_sessions = [M_001, M_002, M_005, M_006, ...] # S1 관련 40개 세션
media_camera_predictions = [1, 1, 1, 1, ...]   # S1에서 media.camera 탐지 결과

# 카메라 사용 탐지 성능 (S1에서 카메라 사용함/안함 구분)
GT_usage = [1, 1, 1, 1, ...]  # 모든 세션이 카메라 사용함
usage_performance = calculate_metrics(GT_usage, media_camera_predictions)

# 카메라 촬영 탐지 성능 (S1에서 촬영함/안함 구분)  
GT_capture = [1, 0, 1, 0, ...]  # 촬영Y=1, 촬영N=0
capture_performance = calculate_metrics(GT_capture, media_camera_predictions)
```

---

### **3. 전체 연구 설계 단계별 완전 가이드**

## **🚀 Stage 1: 준비 단계 (3.2-3.3절)**

### **Step 1-1: 독립변수 정의** (3.2절)
```
입력: 1장 가설 H1, H2
처리: 이론적 근거 기반 조작적 정의
출력: 명확한 변수 기준

앱 아키텍처 (4가지):
S1: 삼성카메라 (직접 API)
S2: 카카오톡 (Intent 기반)  
S3: 텔레그램 (내장 카메라)
S4: 무음카메라 (특수 목적)

휘발성 조건 (4가지):
V0: 즉시 수집
V-Time: 24시간 후
V-Usage: 간섭 후  
V-Event: 재부팅 후
```

### **Step 1-2: 로그 선별** (3.3절)
```
입력: 선행연구 23개 dumpsys 서비스
처리: 3단계 선별 과정
출력: 최종 6개 로그

1단계: 문헌 기반 → 10개 후보 로그
2단계: 이론적 분석 → 6개 유력 후보  
3단계: 파일럿 검증 → 최종 확정 (실제로는 파일럿에서 결정)
```

---

## **🧪 Stage 2: 실험 단계 (3.4절)**

### **Step 2-1: 파일럿 테스트** (3.4.1절)
```
목적: 6개 후보 로그의 실제 탐지 성능 검증
규모: 20세션 (4앱 × 5반복, 촬영Y만, V0만)
절차:
1. S1 앱으로 5회 촬영 실험
2. S2 앱으로 5회 촬영 실험  
3. S3 앱으로 5회 촬영 실험
4. S4 앱으로 5회 촬영 실험
5. 각 세션마다 6개 로그 수집
6. 이중 Ground Truth로 성능 평가
7. 기준 미달 로그 제외 결정
```

### **Step 2-2: 본 실험** (3.4.2-3.4.3절)
```
규모: 160세션
설계: 4앱 × 2케이스 × 4휘발성 × 5반복 = 160세션
절차: 각 세션마다 동일한 수집 과정

예시 세션 (M_045: S2_촬영N_V-Time_3회차):
Day 1: 카카오톡 실행 → 카메라 버튼 터치하지 않음 → 종료
Day 2: 24시간 후 로그 수집 → 6개 로그 탐지 결과 기록
```

---

## **📊 Stage 3: 분석 단계 (3.5절)**

### **Step 3-1: 데이터 전처리** (3.5.1절)
```
입력: 180개 세션의 원본 로그 파일
처리: 
1. 타임스탬프 정규화
2. 카메라 관련 키워드 추출  
3. 세션별 통합
4. 노이즈 제거
출력: 분석 가능한 정제 데이터

실제 처리 예시:
원본: [복잡한 dumpsys 출력 텍스트]
처리 후: [1] 또는 [0] (탐지됨/안됨)
```

### **Step 3-2: 개별 로그 성능 측정** (3.5.2절)

#### **🔍 각 로그별 이중 분석**

**3-2-1: 로그별 탐지 규칙 적용**
```python
# 예시: media.camera 로그 분석
def analyze_media_camera(log_content):
    keywords = ['CONNECT', 'DISCONNECT', 'Camera2ClientBase']
    if any(keyword in log_content for keyword in keywords):
        return 1  # 탐지됨
    return 0      # 미탐지
```

**3-2-2: 이중 성능 계산**
```python
# 180세션 전체 데이터로 각 로그 성능 계산
for log in ['media_camera', 'usagestats', 'activity', 'audio', 'metrics', 'vibrator']:
    
    # 모든 세션의 해당 로그 예측 결과
    predictions = [analyze_log(session[log]) for session in all_sessions]
    
    # 카메라 사용 탐지 성능
    GT_usage = [1, 1, 1, 1, ...]  # 모든 세션이 카메라 사용
    usage_perf = calculate_metrics(GT_usage, predictions)
    
    # 카메라 촬영 탐지 성능
    GT_capture = [1, 0, 1, 0, ...]  # 촬영Y=1, 촬영N=0  
    capture_perf = calculate_metrics(GT_capture, predictions)
```

#### **📈 성능 지표 계산**
```python
def calculate_metrics(ground_truth, predictions):
    TP = 실제1_예측1의_개수
    FP = 실제0_예측1의_개수
    TN = 실제0_예측0의_개수  
    FN = 실제1_예측0의_개수
    
    Precision = TP / (TP + FP)
    Recall = TP / (TP + FN)
    F1_Score = 2 × (Precision × Recall) / (Precision + Recall)
    Accuracy = (TP + TN) / (TP + FP + TN + FN)
    
    return {precision, recall, f1_score, accuracy}
```

### **Step 3-3: 통계적 가설 검증** (3.5.3절)

#### **🔬 H1 가설 검증: 앱별 성능 차이**

```python
# 예시: media.camera 로그의 앱별 촬영 탐지 성능 비교
S1_F1_scores = [0.85, 0.87, 0.83, 0.86, 0.84]  # S1 관련 5개 반복실험 F1점수
S2_F1_scores = [0.78, 0.80, 0.79, 0.77, 0.81]  # S2 관련 5개 반복실험 F1점수  
S3_F1_scores = [0.72, 0.74, 0.70, 0.73, 0.71]  # S3 관련 5개 반복실험 F1점수
S4_F1_scores = [0.65, 0.67, 0.63, 0.66, 0.64]  # S4 관련 5개 반복실험 F1점수

# ANOVA 검정
from scipy.stats import f_oneway
F_statistic, p_value = f_oneway(S1_F1_scores, S2_F1_scores, S3_F1_scores, S4_F1_scores)

if p_value < 0.05:
    print("H1 가설 채택: 앱별로 유의미한 성능 차이 존재")
```

#### **🔬 H2 가설 검증: 휘발성별 성능 변화**

```python
# 예시: media.camera 로그의 휘발성별 성능 변화
V0_F1_scores = [0.90, 0.92, 0.89, 0.91, 0.88]    # V0 조건 5개 반복
V_Time_F1_scores = [0.76, 0.78, 0.75, 0.77, 0.74] # V-Time 조건 5개 반복  
V_Usage_F1_scores = [0.58, 0.60, 0.57, 0.59, 0.56] # V-Usage 조건 5개 반복
V_Event_F1_scores = [0.12, 0.14, 0.11, 0.13, 0.10] # V-Event 조건 5개 반복

# ANOVA + 추세분석
F_statistic, p_value = f_oneway(V0_F1_scores, V_Time_F1_scores, V_Usage_F1_scores, V_Event_F1_scores)

if p_value < 0.05:
    print("H2 가설 채택: 휘발성 조건별로 성능이 단조감소함")
```

---

## **📊 Stage 4: 결과 해석 단계**

### **Step 4-1: 개별 로그 성능 결과** (RQ1 답변)

```
예상 결과:
media.camera:
- 카메라 사용 탐지: F1=0.92 (매우 우수)
- 카메라 촬영 탐지: F1=0.58 (제한적)

audio:  
- 카메라 사용 탐지: F1=0.52 (제한적)
- 카메라 촬영 탐지: F1=0.85 (우수)

→ RQ1 답변: "각 로그는 서로 다른 탐지 특성을 가짐"
```

### **Step 4-2: 독립변수 영향 결과** (RQ2 답변)

```
예상 결과:
H1 (앱별 차이):
- audio 로그: S4(무음카메라)에서 급격한 성능 저하 (F1: 0.85→0.15)
- media.camera: 앱별 차이 미미 (F1: 0.85~0.92)

H2 (휘발성별 변화):  
- media.camera: 재부팅 후 거의 완전 소실 (F1: 0.92→0.12)
- usagestats: 24시간까지 상대적 안정 (F1: 0.95→0.88)

→ RQ2 답변: "로그별로 독립변수 민감도가 크게 다름"
```

### **Step 4-3: 실무적 가이드라인 도출**

```
포렌식 수사 시나리오별 권장사항:

1. 카메라 앱 사용 의심 → usagestats + media.camera 우선 확인
2. 실제 촬영 행위 확인 → audio + media.metrics 집중 분석  
3. 무음 카메라 의심 → audio 로그 신뢰도 낮음, vibrator_manager 활용
4. 시간 경과 많은 경우 → usagestats가 상대적으로 안정적
5. 재부팅된 기기 → 대부분 로그 소실, 복구 어려움
```

---

## **🎯 핵심 포인트 정리**

### **✅ 이해해야 할 핵심 3가지**

1. **이중 Ground Truth**: 같은 데이터로 "사용 탐지"와 "촬영 탐지" 2가지 성능 측정
2. **분석 단위**: 세션별 수집 → 그룹별 집계 → 로그별 성능 계산
3. **연구 흐름**: 준비(변수정의+로그선별) → 실험(파일럿+본실험) → 분석(전처리+성능측정+통계검증) → 해석(가이드라인도출)

### **💡 연구의 독창성**
- **기존**: 촬영Y/N 단순 구분
- **본연구**: 각 로그가 **언제부터** 무엇을 **얼마나 잘** 탐지하는지 정량적 규명

이로써 **"어떤 상황에서 어떤 로그를 사용해야 하는가"**라는 실무적 질문에 과학적 근거를 제공할 수 있게 됩니다.